import{d as E,a as g,m as w,b as q,_ as k,o as n,c,e,F as T,f as B,i as p,t as f,I as V,w as S,v as A,r as b,g as r,bq as F,aq as C}from"./index-a232e2f3.js";import{S as x}from"./sweetalert2.all-32a2f653.js";import{u as P}from"./useLoadingStore-f2bb9720.js";const{VITE_API:$,VITE_API_PATH:v}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/Vue3-training-2022-Winter/Week6/dist/",MODE:"production",DEV:!1,PROD:!0},{loadingState:I}=P(),y=E("useCartStore",{state:()=>({cart:{carts:[]}}),actions:{getCart(){const t=`${$}/api/${v}/cart`;g.get(t).then(s=>{this.cart=s.data.data,I(!1)}).catch(s=>{I(!1),alert(s)})},clearAllCarts(){const t=`${$}/api/${v}/carts`;g.delete(t).then(()=>{x.fire({position:"center",icon:"success",title:"購物車已清空",showConfirmButton:!1,timer:1500}),this.getCart()}).catch(s=>{alert(s)})},deleteCartItem(t){const s=`${$}/api/${v}/cart/${t}`;g.delete(s).then(()=>{this.getCart(),x.fire({position:"center",icon:"success",title:"已刪除",showConfirmButton:!1,allowOutsideClick:!1,timer:1500})}).catch(l=>{alert(l)})},updateCartItem(t){const s=`${$}/api/${v}/cart/${t.id}`,l={product_id:t.product_id,qty:t.qty};!t.qty||t.qty==="e"?(l.qty=1,alert("商品數量不得小於 1 個")):t.qty>=20&&(l.qty=20,alert("商品數量不得大於 20 個")),this.loadingItem=t.id,g.put(s,{data:l}).then(()=>{this.getCart(),x.fire({position:"center",icon:"success",title:"數量已更新",showConfirmButton:!1,timer:1500}),this.loadingItem=""}).catch(_=>{alert(_)})}},getters:{}}),U={data(){return{cartStatus:!1}},mounted(){this.getCart()},computed:{...w(y,["cart"])},methods:{...q(y,["getCart","clearAllCarts","deleteCartItem","updateCartItem"]),deleteItem(t){this.deleteCartItem(t)}}},L={key:0,class:"text-center"},N=e("p",{class:"fs-4"},"購物車空空的，快去買東西吧",-1),O=[N],D={key:1},M={class:"text-end"},H=["disabled"],R={class:"table align-middle"},W=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),j=["onClick"],z={key:0,class:"text-success"},G={class:"input-group input-group-sm"},J={class:"input-group mb-3"},K=["onUpdate:modelValue","onBlur"],Q={class:"input-group-text",id:"basic-addon2"},X={class:"text-end"},Y={key:0,class:"text-success"},Z={key:0},ee=e("td",{colspan:"3",class:"text-end"},"總計",-1),te={class:"text-end"},se={key:1},oe=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ae={class:"text-end text-success"};function le(t,s,l,_,o,h){var d,i;return t.cart.carts.length?(n(),c("div",D,[e("div",M,[e("button",{onClick:s[0]||(s[0]=(...a)=>t.clearAllCarts&&t.clearAllCarts(...a)),class:"btn btn-outline-danger",type:"button",disabled:!((i=(d=t.cart)==null?void 0:d.carts)!=null&&i.length)}," 清空購物車 ",8,H)]),e("table",R,[W,e("tbody",null,[t.cart.carts?(n(!0),c(T,{key:0},B(t.cart.carts,a=>(n(),c("tr",{key:a.id},[e("td",null,[e("button",{onClick:m=>h.deleteItem(a.id),class:"btn btn-outline-danger btn-sm",type:"button"}," x ",8,j)]),e("td",null,[p(f(a.product.title)+" ",1),a.coupon_code?(n(),c("div",z," 已套用優惠券 ")):V("",!0)]),e("td",null,[e("div",G,[e("div",J,[S(e("input",{"onUpdate:modelValue":m=>a.qty=m,onBlur:m=>t.updateCartItem(a),class:"form-control",min:"1",max:"20",type:"number"},null,40,K),[[A,a.qty,void 0,{number:!0}]]),e("span",Q,f(a.product.unit),1)])])]),e("td",X,[a.coupon_code?(n(),c("small",Y,"折扣價：")):V("",!0),p(" "+f(a.total),1)])]))),128)):V("",!0)]),e("tfoot",null,[t.cart.total===t.cart.final_total?(n(),c("tr",Z,[ee,e("td",te,f(t.cart.total),1)])):(n(),c("tr",se,[oe,e("td",ae,f(t.cart.final_total),1)]))])])])):(n(),c("div",L,O))}const re=k(U,[["render",le]]),ne={data(){return{order:{user:{email:"",name:"",tel:"",address:""},message:""}}},computed:{...w(y,["cart"])},methods:{...q(y,["getCart"]),submitOrder(){var l,_;const t="https://vue3-course-api.hexschool.io/v2/api/benson-vue3/order",s=this.order;(_=(l=this.cart)==null?void 0:l.carts)!=null&&_.length?this.$http.post(t,{data:s}).then(()=>{this.getCart(),x.fire({position:"center",icon:"success",title:"訂單已送出成功",showConfirmButton:!1,allowOutsideClick:!1,timer:1500}),this.$refs.form.resetForm(),this.order.message=""}).catch(o=>{alert(o.response)}):alert("請先加入商品才能送出訂單!")},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼: 09xx xxx xxx"}}},ce={class:"my-5 row justify-content-center"},de={class:"mb-3"},ie=e("label",{for:"email",class:"form-label"},[p(" Email "),e("span",{class:"text-danger"},"*")],-1),ue={class:"mb-3"},me=e("label",{for:"name",class:"form-label"},[p(" 收件人姓名 "),e("span",{class:"text-danger"},"*")],-1),_e={class:"mb-3"},pe=e("label",{for:"tel",class:"form-label"},[p(" 收件人電話 "),e("span",{class:"text-danger"},"*")],-1),he={class:"mb-3"},fe=e("label",{for:"address",class:"form-label"},[p(" 收件人地址 "),e("span",{class:"text-danger"},"*")],-1),be={class:"mb-3"},ge=e("label",{for:"message",class:"form-label"},"留言",-1),Ce={class:"text-end"},$e=["disabled"];function ve(t,s,l,_,o,h){const d=b("Field"),i=b("ErrorMessage"),a=b("Form");return n(),c("div",ce,[r(a,{ref:"form",class:"col-md-6",onSubmit:h.submitOrder},{default:F(({errors:m})=>[e("div",de,[ie,r(d,{class:C([{"is-invalid":m.email},"form-control"]),id:"email",name:"email",placeholder:"請輸入 Email",type:"email",rules:"email|required",modelValue:o.order.user.email,"onUpdate:modelValue":s[0]||(s[0]=u=>o.order.user.email=u)},null,8,["class","modelValue"]),r(i,{name:"email",class:"invalid-feedback"})]),e("div",ue,[me,r(d,{class:C([{"is-invalid":m.姓名},"form-control"]),id:"name",name:"姓名",placeholder:"請輸入姓名",rules:"required",modelValue:o.order.user.name,"onUpdate:modelValue":s[1]||(s[1]=u=>o.order.user.name=u),type:"text"},null,8,["class","modelValue"]),r(i,{name:"姓名",class:"invalid-feedback"})]),e("div",_e,[pe,r(d,{class:C([{"is-invalid":m.電話},"form-control"]),id:"tel",name:"電話",placeholder:"請輸入電話",type:"tel",modelValue:o.order.user.tel,"onUpdate:modelValue":s[2]||(s[2]=u=>o.order.user.tel=u),rules:h.isPhone},null,8,["class","modelValue","rules"]),r(i,{name:"電話",class:"invalid-feedback"})]),e("div",he,[fe,r(d,{class:C([{"is-invalid":m.地址},"form-control"]),id:"address",name:"地址",placeholder:"請輸入地址",rules:"required",type:"text",modelValue:o.order.user.address,"onUpdate:modelValue":s[3]||(s[3]=u=>o.order.user.address=u)},null,8,["class","modelValue"]),r(i,{name:"地址",class:"invalid-feedback"})]),e("div",be,[ge,S(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=u=>o.order.message=u)},null,512),[[A,o.order.message]])]),e("div",Ce,[e("button",{type:"submit",class:"btn btn-danger",disabled:!t.cart.carts.length}," 送出訂單 ",8,$e)])]),_:1},8,["onSubmit"])])}const xe=k(ne,[["render",ve]]),ye={components:{CartList:re,TheForm:xe}},Ve={class:"container w-75"},ke=e("h2",{class:"text-center my-4"},"購物車頁",-1);function Ie(t,s,l,_,o,h){const d=b("CartList"),i=b("TheForm");return n(),c("section",Ve,[ke,r(d),r(i)])}const Ae=k(ye,[["render",Ie]]);export{Ae as default};
