import{d as E,a as g,m as A,b as y,_ as k,o as l,c as d,e,F as S,f as B,i as p,t as b,I,w as T,v as q,r as _,g as n,bq as F,aq as x}from"./index-36529d55.js";import{S as v}from"./sweetalert2.all-d64b939e.js";import{u as w,T as L}from"./TheLoading-93860078.js";const{VITE_API:C,VITE_API_PATH:$}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/Vue3-training-2022-Winter/Week6/dist/",MODE:"production",DEV:!1,PROD:!0},V=E("useCartStore",{state:()=>({cart:{carts:[]}}),actions:{getCart(){const t=`${C}/api/${$}/cart`;g.get(t).then(s=>{this.cart=s.data.data}).catch(s=>{alert(s)})},clearAllCarts(){const t=`${C}/api/${$}/carts`;g.delete(t).then(()=>{v.fire({position:"center",icon:"success",title:"購物車已清空",showConfirmButton:!1,timer:1500}),this.getCart()}).catch(s=>{alert(s)})},deleteCartItem(t){const s=`${C}/api/${$}/cart/${t}`;this.loadingItem=t,g.delete(s).then(()=>{this.getCart(),v.fire({position:"center",icon:"success",title:"已刪除",showConfirmButton:!1,timer:1500}),this.loadingItem=""}).catch(r=>{alert(r)})},updateCartItem(t){const s=`${C}/api/${$}/cart/${t.id}`,r={product_id:t.product_id,qty:t.qty};!t.qty||t.qty==="e"?(r.qty=1,alert("商品數量不得小於 1 個")):t.qty>=20&&(r.qty=20,alert("商品數量不得大於 20 個")),this.loadingItem=t.id,g.put(s,{data:r}).then(()=>{this.getCart(),v.fire({position:"center",icon:"success",title:"數量已更新",showConfirmButton:!1,timer:1500}),this.loadingItem=""}).catch(h=>{alert(h)})}},getters:{}}),P={data(){return{cartStatus:!1}},mounted(){this.getCart()},computed:{...A(V,["cart"])},methods:{...y(V,["getCart","clearAllCarts","deleteCartItem","updateCartItem"]),...y(w,["doAjax"]),deleteItem(t){this.deleteCartItem(t),this.doAjax(1e3)}}},U={key:0,class:"text-center"},N=e("p",{class:"fs-4"},"購物車空空的，快去買東西吧",-1),j=[N],D={key:1},M={class:"text-end"},O=["disabled"],H={class:"table align-middle"},R=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),W=["onClick"],z={key:0,class:"text-success"},G={class:"input-group input-group-sm"},J={class:"input-group mb-3"},K=["onUpdate:modelValue","onBlur"],Q={class:"input-group-text",id:"basic-addon2"},X={class:"text-end"},Y={key:0,class:"text-success"},Z={key:0},ee=e("td",{colspan:"3",class:"text-end"},"總計",-1),te={class:"text-end"},se={key:1},oe=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ae={class:"text-end text-success"};function ne(t,s,r,h,a,f){var c,i;return t.cart.carts.length?(l(),d("div",D,[e("div",M,[e("button",{onClick:s[0]||(s[0]=(...o)=>t.clearAllCarts&&t.clearAllCarts(...o)),class:"btn btn-outline-danger",type:"button",disabled:!((i=(c=t.cart)==null?void 0:c.carts)!=null&&i.length)}," 清空購物車 ",8,O)]),e("table",H,[R,e("tbody",null,[t.cart.carts?(l(!0),d(S,{key:0},B(t.cart.carts,o=>(l(),d("tr",{key:o.id},[e("td",null,[e("button",{onClick:m=>f.deleteItem(o.id),class:"btn btn-outline-danger btn-sm",type:"button"}," x ",8,W)]),e("td",null,[p(b(o.product.title)+" ",1),o.coupon_code?(l(),d("div",z," 已套用優惠券 ")):I("",!0)]),e("td",null,[e("div",G,[e("div",J,[T(e("input",{"onUpdate:modelValue":m=>o.qty=m,onBlur:m=>t.updateCartItem(o),class:"form-control",min:"1",max:"20",type:"number"},null,40,K),[[q,o.qty,void 0,{number:!0}]]),e("span",Q,b(o.product.unit),1)])])]),e("td",X,[o.coupon_code?(l(),d("small",Y,"折扣價：")):I("",!0),p(" "+b(o.total),1)])]))),128)):I("",!0)]),e("tfoot",null,[t.cart.total===t.cart.final_total?(l(),d("tr",Z,[ee,e("td",te,b(t.cart.total),1)])):(l(),d("tr",se,[oe,e("td",ae,b(t.cart.final_total),1)]))])])])):(l(),d("div",U,j))}const re=k(P,[["render",ne]]),le={data(){return{order:{user:{email:"",name:"",tel:"",address:""},message:""}}},computed:{...A(V,["cart"])},methods:{...y(V,["getCart"]),submitOrder(){var r,h;const t="https://vue3-course-api.hexschool.io/v2/api/benson-vue3/order",s=this.order;(h=(r=this.cart)==null?void 0:r.carts)!=null&&h.length?this.$http.post(t,{data:s}).then(()=>{this.getCart(),v.fire({position:"center",icon:"success",title:"訂單已送出成功",showConfirmButton:!1,timer:1500}),this.$refs.form.resetForm(),this.order.message=""}).catch(a=>{alert(a.response)}):alert("請先加入商品才能送出訂單!")},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼: 09xx xxx xxx"}}},de={class:"my-5 row justify-content-center"},ce={class:"mb-3"},ie=e("label",{for:"email",class:"form-label"},[p(" Email "),e("span",{class:"text-danger"},"*")],-1),ue={class:"mb-3"},me=e("label",{for:"name",class:"form-label"},[p(" 收件人姓名 "),e("span",{class:"text-danger"},"*")],-1),he={class:"mb-3"},_e=e("label",{for:"tel",class:"form-label"},[p(" 收件人電話 "),e("span",{class:"text-danger"},"*")],-1),pe={class:"mb-3"},fe=e("label",{for:"address",class:"form-label"},[p(" 收件人地址 "),e("span",{class:"text-danger"},"*")],-1),be={class:"mb-3"},ge=e("label",{for:"message",class:"form-label"},"留言",-1),xe={class:"text-end"},Ce=["disabled"];function $e(t,s,r,h,a,f){const c=_("Field"),i=_("ErrorMessage"),o=_("Form");return l(),d("div",de,[n(o,{ref:"form",class:"col-md-6",onSubmit:f.submitOrder},{default:F(({errors:m})=>[e("div",ce,[ie,n(c,{class:x([{"is-invalid":m.email},"form-control"]),id:"email",name:"email",placeholder:"請輸入 Email",type:"email",rules:"email|required",modelValue:a.order.user.email,"onUpdate:modelValue":s[0]||(s[0]=u=>a.order.user.email=u)},null,8,["class","modelValue"]),n(i,{name:"email",class:"invalid-feedback"})]),e("div",ue,[me,n(c,{class:x([{"is-invalid":m.姓名},"form-control"]),id:"name",name:"姓名",placeholder:"請輸入姓名",rules:"required",modelValue:a.order.user.name,"onUpdate:modelValue":s[1]||(s[1]=u=>a.order.user.name=u),type:"text"},null,8,["class","modelValue"]),n(i,{name:"姓名",class:"invalid-feedback"})]),e("div",he,[_e,n(c,{class:x([{"is-invalid":m.電話},"form-control"]),id:"tel",name:"電話",placeholder:"請輸入電話",type:"tel",modelValue:a.order.user.tel,"onUpdate:modelValue":s[2]||(s[2]=u=>a.order.user.tel=u),rules:f.isPhone},null,8,["class","modelValue","rules"]),n(i,{name:"電話",class:"invalid-feedback"})]),e("div",pe,[fe,n(c,{class:x([{"is-invalid":m.地址},"form-control"]),id:"address",name:"地址",placeholder:"請輸入地址",rules:"required",type:"text",modelValue:a.order.user.address,"onUpdate:modelValue":s[3]||(s[3]=u=>a.order.user.address=u)},null,8,["class","modelValue"]),n(i,{name:"地址",class:"invalid-feedback"})]),e("div",be,[ge,T(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=u=>a.order.message=u)},null,512),[[q,a.order.message]])]),e("div",xe,[e("button",{type:"submit",class:"btn btn-danger",disabled:!t.cart.carts.length}," 送出訂單 ",8,Ce)])]),_:1},8,["onSubmit"])])}const ve=k(le,[["render",$e]]),ye={components:{CartList:re,TheForm:ve,TheLoadingVue:L},methods:{...y(w,["doAjax"])},mounted(){this.doAjax(1e3)}},Ve={class:"container w-75"},Ie=e("h2",{class:"text-center my-4"},"購物車頁",-1);function ke(t,s,r,h,a,f){const c=_("CartList"),i=_("TheForm"),o=_("TheLoadingVue");return l(),d("section",Ve,[Ie,n(c),n(i),n(o)])}const we=k(ye,[["render",ke]]);export{we as default};
