import{d as T,a as g,m as k,b as q,_ as V,o as i,c as u,e,F as I,f as F,i as _,t as h,j as x,w as A,v as E,r as b,g as r,k as P,l as $}from"./index-f9f93841.js";const{VITE_API:v,VITE_API_PATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/Vue3-training-2022-Winter/Week6/dist/",MODE:"production",DEV:!1,PROD:!0},y=T("useCartStore",{state:()=>({cart:{carts:[]}}),actions:{getCart(){const t=`${v}/api/${C}/cart`;g.get(t).then(s=>{this.cart=s.data.data}).catch(s=>{alert(s)})},clearAllCarts(){const t=`${v}/api/${C}/carts`;g.delete(t).then(()=>{alert("購物車已清空"),this.getCart()}).catch(s=>{alert(s)})},deleteCartItem(t){const s=`${v}/api/${C}/cart/${t}`;this.loadingItem=t,g.delete(s).then(()=>{alert("已刪除"),this.getCart(),this.loadingItem=""}).catch(l=>{alert(l)})},updateCartItem(t){const s=`${v}/api/${C}/cart/${t.id}`,l={product_id:t.product_id,qty:t.qty};!t.qty||t.qty==="e"?(l.qty=1,alert("商品數量不得小於 1 個")):t.qty>=20&&(l.qty=20,alert("商品數量不得大於 20 個")),this.loadingItem=t.id,g.put(s,{data:l}).then(()=>{this.getCart(),alert("數量已更新"),this.loadingItem=""}).catch(p=>{alert(p)})}},getters:{}}),w={mounted(){this.getCart()},computed:{...k(y,["cart"])},methods:{...q(y,["getCart","clearAllCarts","deleteCartItem","updateCartItem"])}},S={class:"text-end"},U=["disabled"],B={class:"table align-middle"},N=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),D=["onClick","disabled"],L={key:0,class:"text-success"},M={class:"input-group input-group-sm"},O={class:"input-group mb-3"},j=["onUpdate:modelValue","onBlur","disabled"],H={class:"input-group-text",id:"basic-addon2"},R={class:"text-end"},W={key:0,class:"text-success"},z={key:0},G=e("td",{colspan:"3",class:"text-end"},"總計",-1),J={class:"text-end"},K={key:1},Q=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),X={class:"text-end text-success"};function Y(t,s,l,p,a,f){var n,d;return i(),u(I,null,[e("div",S,[e("button",{onClick:s[0]||(s[0]=(...o)=>t.clearAllCarts&&t.clearAllCarts(...o)),class:"btn btn-outline-danger",type:"button",disabled:!((d=(n=t.cart)==null?void 0:n.carts)!=null&&d.length)}," 清空購物車 ",8,U)]),e("table",B,[N,e("tbody",null,[t.cart.carts?(i(!0),u(I,{key:0},F(t.cart.carts,o=>(i(),u("tr",{key:o.id},[e("td",null,[e("button",{onClick:m=>t.deleteCartItem(o.id),class:"btn btn-outline-danger btn-sm",type:"button",disabled:t.loadingItem===o.id}," x ",8,D)]),e("td",null,[_(h(o.product.title)+" ",1),o.coupon_code?(i(),u("div",L,"已套用優惠券")):x("",!0)]),e("td",null,[e("div",M,[e("div",O,[A(e("input",{"onUpdate:modelValue":m=>o.qty=m,onBlur:m=>t.updateCartItem(o),class:"form-control",min:"1",max:"20",type:"number",disabled:t.loadingItem===o.id},null,40,j),[[E,o.qty,void 0,{number:!0}]]),e("span",H,h(o.product.unit),1)])])]),e("td",R,[o.coupon_code?(i(),u("small",W,"折扣價：")):x("",!0),_(" "+h(o.total),1)])]))),128)):x("",!0)]),e("tfoot",null,[t.cart.total===t.cart.final_total?(i(),u("tr",z,[G,e("td",J,h(t.cart.total),1)])):(i(),u("tr",K,[Q,e("td",X,h(t.cart.final_total),1)]))])])],64)}const Z=V(w,[["render",Y]]),ee={data(){return{order:{user:{email:"",name:"",tel:"",address:""},message:""}}},computed:{...k(y,["cart"])},methods:{...q(y,["getCart"]),submitOrder(){var l,p;const t="https://vue3-course-api.hexschool.io/v2/api/benson-vue3/order",s=this.order;(p=(l=this.cart)==null?void 0:l.carts)!=null&&p.length?this.$http.post(t,{data:s}).then(a=>{this.getCart(),alert(a.data.message),this.$refs.form.resetForm(),this.order.message=""}).catch(a=>{alert(a.response)}):alert("請先加入商品才能送出訂單!")},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"需要正確的電話號碼: 09xx xxx xxx"}}},te={class:"my-5 row justify-content-center"},se={class:"mb-3"},ae=e("label",{for:"email",class:"form-label"},[_(" Email "),e("span",{class:"text-danger"},"*")],-1),oe={class:"mb-3"},le=e("label",{for:"name",class:"form-label"},[_(" 收件人姓名 "),e("span",{class:"text-danger"},"*")],-1),re={class:"mb-3"},ne=e("label",{for:"tel",class:"form-label"},[_(" 收件人電話 "),e("span",{class:"text-danger"},"*")],-1),de={class:"mb-3"},ce=e("label",{for:"address",class:"form-label"},[_(" 收件人地址 "),e("span",{class:"text-danger"},"*")],-1),ie={class:"mb-3"},ue=e("label",{for:"message",class:"form-label"},"留言",-1),me={class:"text-end"},pe=["disabled"];function _e(t,s,l,p,a,f){const n=b("Field"),d=b("ErrorMessage"),o=b("Form");return i(),u("div",te,[r(o,{ref:"form",class:"col-md-6",onSubmit:f.submitOrder},{default:P(({errors:m})=>[e("div",se,[ae,r(n,{class:$([{"is-invalid":m.email},"form-control"]),id:"email",name:"email",placeholder:"請輸入 Email",type:"email",rules:"email|required",modelValue:a.order.user.email,"onUpdate:modelValue":s[0]||(s[0]=c=>a.order.user.email=c)},null,8,["class","modelValue"]),r(d,{name:"email",class:"invalid-feedback"})]),e("div",oe,[le,r(n,{class:$([{"is-invalid":m.姓名},"form-control"]),id:"name",name:"姓名",placeholder:"請輸入姓名",rules:"required",modelValue:a.order.user.name,"onUpdate:modelValue":s[1]||(s[1]=c=>a.order.user.name=c),type:"text"},null,8,["class","modelValue"]),r(d,{name:"姓名",class:"invalid-feedback"})]),e("div",re,[ne,r(n,{class:$([{"is-invalid":m.電話},"form-control"]),id:"tel",name:"電話",placeholder:"請輸入電話",type:"tel",modelValue:a.order.user.tel,"onUpdate:modelValue":s[2]||(s[2]=c=>a.order.user.tel=c),rules:f.isPhone},null,8,["class","modelValue","rules"]),r(d,{name:"電話",class:"invalid-feedback"})]),e("div",de,[ce,r(n,{class:$([{"is-invalid":m.地址},"form-control"]),id:"address",name:"地址",placeholder:"請輸入地址",rules:"required",type:"text",modelValue:a.order.user.address,"onUpdate:modelValue":s[3]||(s[3]=c=>a.order.user.address=c)},null,8,["class","modelValue"]),r(d,{name:"地址",class:"invalid-feedback"})]),e("div",ie,[ue,A(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[4]||(s[4]=c=>a.order.message=c)},null,512),[[E,a.order.message]])]),e("div",me,[e("button",{type:"submit",class:"btn btn-danger",disabled:!t.cart.carts.length}," 送出訂單 ",8,pe)])]),_:1},8,["onSubmit"])])}const he=V(ee,[["render",_e]]),be={components:{CartList:Z,TheForm:he},methods:{}},fe={class:"container w-75"},ge=e("h2",{class:"text-center my-3"},"購物車頁",-1);function $e(t,s,l,p,a,f){const n=b("CartList"),d=b("TheForm");return i(),u("section",fe,[ge,r(n),r(d)])}const Ce=V(be,[["render",$e]]);export{Ce as default};
