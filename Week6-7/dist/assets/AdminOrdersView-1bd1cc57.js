import{M as k}from"./modal-e715d6fb.js";import{_ as O,o as a,c as i,e as t,t as n,p as S,F as b,f,w,B as D,i as v,b as x,r as _,g as m,s as P}from"./index-e4284eff.js";import{T as V}from"./ThePagination-8ea93132.js";import{u as T}from"./useLoadingStore-9d97ba22.js";import{u as E}from"./useToastMessageStore-735ffa67.js";const I={props:{order:{type:Object,default(){return{}}}},emits:["updateOrder"],data(){return{modal:{},tempOrder:{products:{},user:{}}}},watch:{order(){this.tempOrder=this.order}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},createDate(d){const e=new Date(d*1e3),l=e.getFullYear(),u=e.getMonth()+1>=10?e.getMonth()+1:`0${e.getMonth()+1}`,s=e.getDate()>=10?e.getDate():`0${e.getDate()}`;return`${l}/${u}/${s}`}},mounted(){this.modal=new k(this.$refs.modal)}},U={class:"modal fade",ref:"modal",tabindex:"-1"},B={class:"modal-dialog modal-xl"},N={class:"modal-content"},j={class:"modal-header bg-dark text-light"},F={class:"fs-5"},L=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},H={class:"container-fluid"},R={class:"row"},W={class:"col-md-5"},Y=t("h3",{class:"mb-3"},"訂購人資料",-1),q={class:"table"},z={key:0},J=t("th",{style:{width:"100px"}},"姓名",-1),K=t("th",null,"Email",-1),Q=t("th",null,"電話",-1),X=t("th",null,"地址",-1),Z={class:"col-md-7"},tt=t("h3",{class:"mb-3"},"訂單明細",-1),et={class:"table"},st=t("th",{style:{width:"100px"}},"訂單編號",-1),ot=t("th",null,"下單時間",-1),dt=t("th",null,"付款狀態",-1),nt={key:0,class:"text-success"},lt={key:1,class:"text-muted"},at=t("th",null,"總金額",-1),it=t("h4",null,"訂購商品",-1),rt={class:"table"},ct=t("thead",null,[t("tr",null,[t("th",{width:"15%"}),t("th",{width:"35%"}),t("th",{width:"20%"}),t("th",{width:"15%"}),t("th",{width:"15%"})])],-1),ht={class:"text-center"},ut=["src"],_t={class:"fs-5"},mt={class:"text-end"},pt={class:"d-flex justify-content-end"},gt={class:"form-check"},bt={class:"form-check-label",for:"flexCheckDefault"},ft={key:0},Ot={key:1},$t={class:"modal-footer"},yt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Mt(d,e,l,u,s,c){return a(),i("div",U,[t("div",B,[t("div",N,[t("div",j,[t("h2",F,"訂單編號 : "+n(s.tempOrder.id),1),L]),t("div",G,[t("div",H,[t("div",R,[t("div",W,[Y,t("table",q,[s.tempOrder.user?(a(),i("tbody",z,[t("tr",null,[J,t("td",null,n(s.tempOrder.user.name),1)]),t("tr",null,[K,t("td",null,n(s.tempOrder.user.email),1)]),t("tr",null,[Q,t("td",null,n(s.tempOrder.user.tel),1)]),t("tr",null,[X,t("td",null,n(s.tempOrder.user.address),1)])])):S("",!0)])]),t("div",Z,[tt,t("table",et,[t("tbody",null,[t("tr",null,[st,t("td",null,n(s.tempOrder.id),1)]),t("tr",null,[ot,t("td",null,n(c.createDate(s.tempOrder.create_at)),1)]),t("tr",null,[dt,t("td",null,[s.tempOrder.is_paid?(a(),i("strong",nt,"已付款")):(a(),i("span",lt,"尚未付款"))])]),t("tr",null,[at,t("td",null,n(s.tempOrder.total),1)])])]),it,t("table",rt,[ct,t("tbody",null,[(a(!0),i(b,null,f(s.tempOrder.products,r=>(a(),i("tr",{key:r.id,class:"align-middle"},[t("td",ht,[t("img",{src:r.product.imageUrl,class:"object-fit-cover",style:{height:"100px",width:"100px"}},null,8,ut)]),t("td",_t,n(r.product.title),1),t("td",null,"NT$ "+n(r.product.price),1),t("td",null,n(r.qty)+" "+n(r.product.unit),1),t("td",mt,"$ "+n(r.final_total),1)]))),128))])]),t("div",pt,[t("div",gt,[w(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":e[0]||(e[0]=r=>s.tempOrder.is_paid=r)},null,512),[[D,s.tempOrder.is_paid]]),t("label",bt,[s.tempOrder.is_paid?(a(),i("span",ft,"已付款")):(a(),i("span",Ot,"未付款"))])])])])])])]),t("div",$t,[yt,t("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=r=>d.$emit("updateOrder",s.tempOrder))}," 修改訂單 ")])])])],512)}const vt=O(I,[["render",Mt]]),xt={props:{tempOrder:{type:Object}},data(){return{modal:{}}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},deleteOrder(d){this.$emit("deleteOrder",d),this.closeModal()}},mounted(){this.modal=new k(this.$refs.modal)}},kt={class:"modal",ref:"modal",tabindex:"-1"},wt={class:"modal-dialog"},Dt={class:"modal-content"},At=t("div",{class:"modal-header bg-danger text-white"},[t("h2",null,"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ct={class:"modal-body"},St={class:"text-danger"},Pt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Tt(d,e,l,u,s,c){return a(),i("div",kt,[t("div",wt,[t("div",Dt,[At,t("div",Ct,[v(" 是否刪除 "),t("strong",St,n(l.tempOrder.id),1),v(" 訂單(刪除後將無法恢復)。 ")]),t("div",Pt,[Vt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=r=>c.deleteOrder(l.tempOrder.id))}," 確認刪除 ")])])])],512)}const Et=O(xt,[["render",Tt]]),{VITE_API:p,VITE_API_PATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"benson-vue3",BASE_URL:"/Vue3-training-2022-Winter/Week6-7/dist/",MODE:"production",DEV:!1,PROD:!0},It={components:{AdminOrderModal:vt,AdminOrderDeleteModal:Et,ThePagination:V},data(){return{orders:[],tempOrder:{},pagination:{},currentPage:1}},methods:{...x(T,["loadingState"]),...x(E,["pushMessage"]),getOrders(d=1){this.currentPage=d;const e=`${p}/api/${g}/admin/orders?page=${d}`;this.loadingState(!0),this.$http.get(e).then(l=>{this.orders=l.data.orders,this.pagination=l.data.pagination,this.loadingState(!1)}).catch(l=>{this.pushMessage({style:"danger",title:"取得訂單資料失敗",content:`${l.response.data.message}`}),this.loadingState(!1)})},createDate(d){const e=new Date(d*1e3),l=e.getFullYear(),u=e.getMonth()+1>=10?e.getMonth()+1:`0${e.getMonth()+1}`,s=e.getDate()>=10?e.getDate():`0${e.getDate()}`;return`${l}/${u}/${s}`},openModal(d,e){d==="edit"?(this.tempOrder={...e},this.$refs.orderModal.openModal()):(this.tempOrder={...e},this.$refs.deleteOrderModal.openModal())},updateOrder(d){const e=`${p}/api/${g}/admin/order/${d.id}`;this.loadingState(!0),this.tempOrder={...d},this.$http.put(e,{data:this.tempOrder}).then(()=>{this.getOrders(this.currentPage),this.loadingState(!1),this.$refs.orderModal.closeModal(),this.pushMessage({title:"更改訂單成功"})}).catch(l=>{this.pushMessage({style:"danger",title:"更改失敗，請稍後再試",content:`${l.response.data.message}`}),this.loadingState(!1)})},deleteOrder(d){const e=`${p}/api/${g}/admin/order/${d}`;this.loadingState(!0),this.$http.delete(e).then(()=>{this.getOrders(this.currentPage),this.loadingState(!1),this.pushMessage({title:"已刪除訂單"})}).catch(l=>{this.pushMessage({style:"danger",title:"更改失敗，請稍後再試",content:`${l.response.data.message}`}),this.loadingState(!1)})}},mounted(){this.getOrders()}},Ut={class:"container my-4"},Bt=t("h2",{class:"text-center my-3"},"訂單列表",-1),Nt={class:"table mt-4 container"},jt=t("thead",null,[t("tr",null,[t("th",{width:"15%"},"訂單日期"),t("th",{width:"25%"},"訂購人資訊"),t("th",{width:"30%"},"訂購商品"),t("th",{width:"15%"},"訂單狀態"),t("th",{width:"15%"},"操作")])],-1),Ft={class:"d-flex flex-column"},Lt=["href"],Gt={class:"form-check form-switch"},Ht=["id","onChange","onUpdate:modelValue"],Rt=["for"],Wt={class:"btn-group"},Yt=["onClick"],qt=["onClick"];function zt(d,e,l,u,s,c){const r=_("ThePagination"),A=_("AdminOrderModal"),C=_("AdminOrderDeleteModal");return a(),i("div",Ut,[Bt,t("table",Nt,[jt,t("tbody",null,[(a(!0),i(b,null,f(s.orders,o=>{var $,y,M;return a(),i("tr",{key:o.id,class:"align-middle"},[t("td",null,n(c.createDate(o.create_at)),1),t("td",null,[t("div",Ft,[t("span",null,n(($=o==null?void 0:o.user)==null?void 0:$.name),1),t("a",{href:`mailto:${(y=o==null?void 0:o.user)==null?void 0:y.email}`,class:"d-block"},n((M=o==null?void 0:o.user)==null?void 0:M.email),9,Lt)])]),t("td",null,[t("ul",null,[(a(!0),i(b,null,f(o.products,h=>(a(),i("li",{key:h.id},n(h.product.title),1))),128))])]),t("td",null,[t("div",Gt,[w(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,onChange:h=>c.updateOrder(o),"onUpdate:modelValue":h=>o.is_paid=h},null,40,Ht),[[D,o.is_paid]]),t("label",{class:P(["form-check-label",{"text-success":o.is_paid,"text-danger":!o.is_paid}]),for:`paidSwitch${o.id}`},n(o.is_paid?"已付款":"未付款"),11,Rt)])]),t("td",null,[t("div",Wt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:h=>c.openModal("edit",o)}," 編輯 ",8,Yt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>c.openModal("delete",o)}," 刪除 ",8,qt)])])])}),128))])]),m(r,{pages:s.pagination,onGetData:c.getOrders},null,8,["pages","onGetData"]),m(A,{onUpdateOrder:c.updateOrder,ref:"orderModal",order:s.tempOrder},null,8,["onUpdateOrder","order"]),m(C,{ref:"deleteOrderModal","temp-order":s.tempOrder,onDeleteOrder:c.deleteOrder},null,8,["temp-order","onDeleteOrder"])])}const te=O(It,[["render",zt]]);export{te as default};
